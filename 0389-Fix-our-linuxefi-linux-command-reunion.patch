From 23dbe2faf748d828fb847769c16cf97895dc31bb Mon Sep 17 00:00:00 2001
From: Peter Jones <pjones@redhat.com>
Date: Thu, 12 Jul 2018 19:39:51 -0400
Subject: [PATCH] Fix our linuxefi/linux command reunion.

Signed-off-by: Peter Jones <pjones@redhat.com>
---
 grub-core/Makefile.core.def       |  4 ++--
 grub-core/loader/i386/efi/linux.c | 13 +++++++++++--
 2 files changed, 13 insertions(+), 4 deletions(-)

diff --git a/grub-core/Makefile.core.def b/grub-core/Makefile.core.def
index ff6fa4bd000..46ebe210263 100644
--- a/grub-core/Makefile.core.def
+++ b/grub-core/Makefile.core.def
@@ -1713,8 +1713,8 @@ module = {
 
 module = {
   name = linux;
-  x86 = loader/i386/linux.c;
-  x86_efi = loader/i386/efi/linux.c;
+  i386_pc = loader/i386/linux.c;
+  x86_64_efi = loader/i386/efi/linux.c;
   i386_efi = loader/i386/efi/linux.c;
   xen = loader/i386/xen.c;
   i386_pc = lib/i386/pc/vesa_modes_table.c;
diff --git a/grub-core/loader/i386/efi/linux.c b/grub-core/loader/i386/efi/linux.c
index 66e58b71e22..498d7ba7158 100644
--- a/grub-core/loader/i386/efi/linux.c
+++ b/grub-core/loader/i386/efi/linux.c
@@ -366,20 +366,29 @@ grub_cmd_linux (grub_command_t cmd __attribute__ ((unused)),
 }
 
 static grub_command_t cmd_linux, cmd_initrd;
+static grub_command_t cmd_linuxefi, cmd_initrdefi;
 
-GRUB_MOD_INIT(linuxefi)
+GRUB_MOD_INIT(linux)
 {
   cmd_linux =
+    grub_register_command ("linux", grub_cmd_linux,
+                           0, N_("Load Linux."));
+  cmd_linuxefi =
     grub_register_command ("linuxefi", grub_cmd_linux,
                            0, N_("Load Linux."));
   cmd_initrd =
+    grub_register_command ("initrd", grub_cmd_initrd,
+                           0, N_("Load initrd."));
+  cmd_initrdefi =
     grub_register_command ("initrdefi", grub_cmd_initrd,
                            0, N_("Load initrd."));
   my_mod = mod;
 }
 
-GRUB_MOD_FINI(linuxefi)
+GRUB_MOD_FINI(linux)
 {
   grub_unregister_command (cmd_linux);
+  grub_unregister_command (cmd_linuxefi);
   grub_unregister_command (cmd_initrd);
+  grub_unregister_command (cmd_initrdefi);
 }
